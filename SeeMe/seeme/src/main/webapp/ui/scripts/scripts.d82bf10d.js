"use strict";angular.module("seeMeApp",["ngResource","ngRoute","ngMap"]).config(["$routeProvider",function(a){a.when("/:deviceId",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/test",{templateUrl:"views/test.html",controller:"TestCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("seeMeApp").service("GpsLogService",["$http","ConfigService",function(a,b){var c=b.baseURL;return{getLatestLog:function(b){return a.get(c+"gpslog/get",{params:{deviceId:b},timeout:5e3})},getLogsSince:function(b,d){return a.get(c+"gpslog/get",{params:{deviceId:b,fromTime:d}})},getLogsTill:function(b,d){return a.get(c+"gpslog/get",{params:{deviceId:b,toTime:d}})},getLogsForInterval:function(b,d,e){return a.get(c+"gpslog/get",{params:{deviceId:b,fromTime:d,toTime:e}})}}}]),angular.module("seeMeApp").controller("MainCtrl",["$scope","$interval","$timeout","$routeParams","GpsLogService","ConfigService","UtilityService",function(a,b,c,d,e,f,g){var h=new google.maps.Marker({icon:f.icon,title:"My Location"});a.pathCoordinates=[],a.addNewCoordinate=function(b){h.setMap(a.map),h.setPosition({lat:b.lat,lng:b.lon}),a.pathCoordinates.push([b.lat,b.lon])},a.lastLocationTime=0;var i=parseInt(d.deviceId);if(void 0!=i&&"number"==typeof i){var j=function(){e.getLatestLog(i).success(function(b){var d=b[0];d.timeAsDate!==a.lastLocationTime&&(a.lastLocationTime=d.timeAsDate,a.addNewCoordinate(d)),c(j,2e3)}).error(function(a,b,d,e){c(j,10)})};j(),a.timeAgo="",a.tickInterval=1e3;var k=function(){a.timeAgo=g.timeSince(new Date(a.lastLocationTime)),c(k,a.tickInterval)};c(k,a.tickInterval)}}]),angular.module("seeMeApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("seeMeApp").controller("TestCtrl",["$scope","$interval","GpsLogService","ConfigService",function(a,b,c,d){a.pathCoordinates=[],a.addNewCoordinate=function(b){a.pathCoordinates.push([b.lat,b.lon])};var e=(new Date).getTime();c.getLogsTill(1,e).success(function(c){if(a.ind=0,c.length>0){a.lastLocationTime=c[c.length-1].time;var e=[c[0].lat,c[0].lon];a.currentCoordinatesLatLng=new google.maps.LatLng(e[0],e[1]);var f=new google.maps.Marker({position:a.currentCoordinatesLatLng,map:a.map,icon:d.icon,title:"My Location"});f.setMap(a.map),b(function(){var b=c[a.ind++];a.addNewCoordinate(b)},2e3,c.length)}})}]),angular.module("seeMeApp").service("ConfigService",["UtilityService",function(a){return{baseURL:"../rest/",icon:{url:a.resolveUrl("images/me.svg"),scaledSize:new google.maps.Size(20,20)}}}]),angular.module("seeMeApp").service("UtilityService",function(){return{timeSince:function(a){var b=Math.floor((new Date-a)/1e3),c=Math.floor(b/31536e3);return c>1?c+" years":(c=Math.floor(b/2592e3),c>1?c+" months":(c=Math.floor(b/86400),c>1?c+" days":(c=Math.floor(b/3600),c>1?c+" hours":(c=Math.floor(b/60),c>1?c+" minutes":Math.floor(b)+" seconds"))))},resolveUrl:function(a){var b=document.createElement("a");return b.href=a,a=b.href}}});